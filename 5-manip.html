<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A MODERN DIVE into Data with R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Getting away from the traditional introductory statistics curriculum, more focused on reproducible research and modern data analysis techniques and tools">
  <meta name="generator" content="bookdown 0.1.5 and GitBook 2.6.7">

  <meta property="og:title" content="A MODERN DIVE into Data with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Getting away from the traditional introductory statistics curriculum, more focused on reproducible research and modern data analysis techniques and tools" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A MODERN DIVE into Data with R" />
  
  <meta name="twitter:description" content="Getting away from the traditional introductory statistics curriculum, more focused on reproducible research and modern data analysis techniques and tools" />
  

<meta name="author" content="Chester Ismay and Albert Y. Kim">

<meta name="date" content="2016-08-26">


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="4-viz.html">
<link rel="next" href="6-collect.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.7/htmlwidgets.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/dygraphs-binding-1.1.1.1/dygraphs.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i><b>1.1</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-intro.html"><a href="2-intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="2-intro.html"><a href="2-intro.html#preamble"><i class="fa fa-check"></i><b>2.1</b> Preamble</a></li>
<li class="chapter" data-level="2.2" data-path="2-intro.html"><a href="2-intro.html#two-driving-data-sources"><i class="fa fa-check"></i><b>2.2</b> Two driving data sources</a></li>
<li class="chapter" data-level="2.3" data-path="2-intro.html"><a href="2-intro.html#datascience-pipeline"><i class="fa fa-check"></i><b>2.3</b> Data/science pipeline</a></li>
<li class="chapter" data-level="2.4" data-path="2-intro.html"><a href="2-intro.html#reproducibility"><i class="fa fa-check"></i><b>2.4</b> Reproducibility</a></li>
<li class="chapter" data-level="2.5" data-path="2-intro.html"><a href="2-intro.html#who-is-this-book-for"><i class="fa fa-check"></i><b>2.5</b> Who is this book for?</a></li>
</ul></li>
<li class="part"><span><b>Data Exploration</b></span></li>
<li class="chapter" data-level="3" data-path="3-tidy.html"><a href="3-tidy.html"><i class="fa fa-check"></i><b>3</b> Tidy data</a><ul>
<li class="chapter" data-level="3.1" data-path="3-tidy.html"><a href="3-tidy.html#what-is-tidy-data"><i class="fa fa-check"></i><b>3.1</b> What is tidy data?</a></li>
<li class="chapter" data-level="3.2" data-path="3-tidy.html"><a href="3-tidy.html#the-nycflights13-datasets"><i class="fa fa-check"></i><b>3.2</b> The <code>nycflights13</code> datasets</a></li>
<li class="chapter" data-level="3.3" data-path="3-tidy.html"><a href="3-tidy.html#how-is-flights-tidy"><i class="fa fa-check"></i><b>3.3</b> How is <code>flights</code> tidy?</a></li>
<li class="chapter" data-level="3.4" data-path="3-tidy.html"><a href="3-tidy.html#normal-forms-of-data"><i class="fa fa-check"></i><b>3.4</b> Normal forms of data</a></li>
<li class="chapter" data-level="3.5" data-path="3-tidy.html"><a href="3-tidy.html#whats-to-come"><i class="fa fa-check"></i><b>3.5</b> What’s to come?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-viz.html"><a href="4-viz.html"><i class="fa fa-check"></i><b>4</b> Visualizing Data</a><ul>
<li class="chapter" data-level="4.1" data-path="4-viz.html"><a href="4-viz.html#five-named-graphs---the-fng"><i class="fa fa-check"></i><b>4.1</b> Five Named Graphs - The FNG</a></li>
<li class="chapter" data-level="4.2" data-path="4-viz.html"><a href="4-viz.html#histograms"><i class="fa fa-check"></i><b>4.2</b> Histograms</a><ul>
<li class="chapter" data-level="4.2.1" data-path="4-viz.html"><a href="4-viz.html#contsum"><i class="fa fa-check"></i><b>4.2.1</b> Continuous data summaries</a></li>
<li class="chapter" data-level="4.2.2" data-path="4-viz.html"><a href="4-viz.html#summary"><i class="fa fa-check"></i><b>4.2.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-viz.html"><a href="4-viz.html#boxplots"><i class="fa fa-check"></i><b>4.3</b> Boxplots</a><ul>
<li class="chapter" data-level="4.3.1" data-path="4-viz.html"><a href="4-viz.html#faceting"><i class="fa fa-check"></i><b>4.3.1</b> Faceting</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-viz.html"><a href="4-viz.html#summary-1"><i class="fa fa-check"></i><b>4.3.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-viz.html"><a href="4-viz.html#barplots"><i class="fa fa-check"></i><b>4.4</b> Barplots</a><ul>
<li class="chapter" data-level="4.4.1" data-path="4-viz.html"><a href="4-viz.html#must-avoid-pie-charts"><i class="fa fa-check"></i><b>4.4.1</b> Must avoid pie charts!</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-viz.html"><a href="4-viz.html#using-barplots-to-compare-two-variables"><i class="fa fa-check"></i><b>4.4.2</b> Using barplots to compare two variables</a></li>
<li class="chapter" data-level="4.4.3" data-path="4-viz.html"><a href="4-viz.html#summary-2"><i class="fa fa-check"></i><b>4.4.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="4-viz.html"><a href="4-viz.html#scatter-plots"><i class="fa fa-check"></i><b>4.5</b> Scatter-plots</a><ul>
<li class="chapter" data-level="4.5.1" data-path="4-viz.html"><a href="4-viz.html#jittering"><i class="fa fa-check"></i><b>4.5.1</b> Jittering</a></li>
<li class="chapter" data-level="4.5.2" data-path="4-viz.html"><a href="4-viz.html#setting-transparency"><i class="fa fa-check"></i><b>4.5.2</b> Setting transparency</a></li>
<li class="chapter" data-level="4.5.3" data-path="4-viz.html"><a href="4-viz.html#summary-3"><i class="fa fa-check"></i><b>4.5.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="4-viz.html"><a href="4-viz.html#line-graphs"><i class="fa fa-check"></i><b>4.6</b> Line-graphs</a><ul>
<li class="chapter" data-level="4.6.1" data-path="4-viz.html"><a href="4-viz.html#interactive-line-graphs"><i class="fa fa-check"></i><b>4.6.1</b> Interactive line-graphs</a></li>
<li class="chapter" data-level="4.6.2" data-path="4-viz.html"><a href="4-viz.html#summary-4"><i class="fa fa-check"></i><b>4.6.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="4-viz.html"><a href="4-viz.html#brief-review-of-the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.7</b> Brief Review of The Grammar of Graphics</a></li>
<li class="chapter" data-level="4.8" data-path="4-viz.html"><a href="4-viz.html#whats-to-come-1"><i class="fa fa-check"></i><b>4.8</b> What’s to come?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-manip.html"><a href="5-manip.html"><i class="fa fa-check"></i><b>5</b> Manipulating Data</a><ul>
<li class="chapter" data-level="5.1" data-path="5-manip.html"><a href="5-manip.html#five-main-verbs---the-fmv"><i class="fa fa-check"></i><b>5.1</b> Five Main Verbs - The FMV</a><ul>
<li class="chapter" data-level="5.1.1" data-path="5-manip.html"><a href="5-manip.html#select-variables-using-select"><i class="fa fa-check"></i><b>5.1.1</b> Select variables using <code id="select">select</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="5-manip.html"><a href="5-manip.html#filter-observations-using-filter"><i class="fa fa-check"></i><b>5.1.2</b> Filter observations using <code id="filter">filter</code></a></li>
<li class="chapter" data-level="5.1.3" data-path="5-manip.html"><a href="5-manip.html#summarize-variables-using-summarize"><i class="fa fa-check"></i><b>5.1.3</b> Summarize variables using <code>summarize</code></a></li>
<li class="chapter" data-level="5.1.4" data-path="5-manip.html"><a href="5-manip.html#create-new-variableschange-old-variables-using-mutate"><i class="fa fa-check"></i><b>5.1.4</b> Create new variables/change old variables using <code>mutate</code></a></li>
<li class="chapter" data-level="5.1.5" data-path="5-manip.html"><a href="5-manip.html#reorder-the-data-frame-using-arrange"><i class="fa fa-check"></i><b>5.1.5</b> Reorder the data frame using <code id="arrange">arrange</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-manip.html"><a href="5-manip.html#the-pipe"><i class="fa fa-check"></i><b>5.2</b> The pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="5.3" data-path="5-manip.html"><a href="5-manip.html#joiningmerging-data-frames"><i class="fa fa-check"></i><b>5.3</b> Joining/merging data frames</a></li>
<li class="chapter" data-level="5.4" data-path="5-manip.html"><a href="5-manip.html#whats-to-come-2"><i class="fa fa-check"></i><b>5.4</b> What’s to come?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-collect.html"><a href="6-collect.html"><i class="fa fa-check"></i><b>6</b> Collecting Data</a><ul>
<li class="chapter" data-level="6.1" data-path="6-collect.html"><a href="6-collect.html#whats-to-come-3"><i class="fa fa-check"></i><b>6.1</b> What’s to come?</a></li>
</ul></li>
<li class="part"><span><b>Inference</b></span></li>
<li class="chapter" data-level="7" data-path="7-infer-basics.html"><a href="7-infer-basics.html"><i class="fa fa-check"></i><b>7</b> Inference Basics</a><ul>
<li class="chapter" data-level="7.1" data-path="7-infer-basics.html"><a href="7-infer-basics.html#whats-to-come-4"><i class="fa fa-check"></i><b>7.1</b> What’s to come?</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-hypo.html"><a href="8-hypo.html"><i class="fa fa-check"></i><b>8</b> Hypothesis Testing</a><ul>
<li class="chapter" data-level="8.1" data-path="8-hypo.html"><a href="8-hypo.html#whats-to-come-5"><i class="fa fa-check"></i><b>8.1</b> What’s to come?</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-ci.html"><a href="9-ci.html"><i class="fa fa-check"></i><b>9</b> Confidence Intervals</a><ul>
<li class="chapter" data-level="9.1" data-path="9-ci.html"><a href="9-ci.html#whats-to-come-6"><i class="fa fa-check"></i><b>9.1</b> What’s to come?</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-regress.html"><a href="10-regress.html"><i class="fa fa-check"></i><b>10</b> Simple and Multiple Regression</a><ul>
<li class="chapter" data-level="10.1" data-path="10-regress.html"><a href="10-regress.html#whats-to-come-7"><i class="fa fa-check"></i><b>10.1</b> What’s to come?</a></li>
</ul></li>
<li class="part"><span><b>Conclusion</b></span></li>
<li class="chapter" data-level="11" data-path="11-conclusion.html"><a href="11-conclusion.html"><i class="fa fa-check"></i><b>11</b> Concluding Remarks</a></li>
<li class="part"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="12" data-path="12-appendix1.html"><a href="12-appendix1.html"><i class="fa fa-check"></i><b>12</b> Appendix A: Intermediate R</a><ul>
<li class="chapter" data-level="12.1" data-path="12-appendix1.html"><a href="12-appendix1.html#sorted-barplots"><i class="fa fa-check"></i><b>12.1</b> Sorted barplots</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-appendix2.html"><a href="13-appendix2.html"><i class="fa fa-check"></i><b>13</b> Appendix B: Statistical Basics</a><ul>
<li class="chapter" data-level="13.1" data-path="13-appendix2.html"><a href="13-appendix2.html#basic-statistical-terms"><i class="fa fa-check"></i><b>13.1</b> Basic statistical terms</a></li>
</ul></li>
<li class="part"><span><b>Bibliography</b></span></li>
<li class="chapter" data-level="14" data-path="14-references.html"><a href="14-references.html"><i class="fa fa-check"></i><b>14</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A MODERN DIVE into Data with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manip" class="section level1">
<h1><span class="header-section-number">5</span> Manipulating Data</h1>
<!--
- Make sure to refer back to plots in the viz chapter and how the
  material here relates to answering those questions
-->
<p>Let’s briefly recap where we have been so far and where we are headed. In Chapter <a href="3-tidy.html#tidy">3</a>, we discussed what it means for data to be tidy. We saw that this corresponds to observations to correspond to rows and for variables to be stored in columns. The entries in the data frame correspond to different combinations of observational units and variables. In the <code>flights</code> data frame, we saw that each row corresponded to a different flight leaving New York City. (In other words, the observational unit of that tidy data frame is a flight.) The variables are listed as columns and for <code>flights</code> they include both quantitative variables like <code>dep_delay</code> and <code>distance</code> but also categorical variables like <code>carrier</code> and <code>origin</code>. An entry in the table corresponds to a particular flight and a particular value of a given variable representing that flight.</p>
<p>We saw in Chapter <a href="4-viz.html#viz">4</a> that organizing data in this tidy way makes it easy for use to produce graphics. We can simply specify what variable/column we would like on one axis, what variable we’d like on the other axis, and what type of plot we’d like to make. We can also do things such as changing the color by another variable or change the size of our points by a fourth variable given this tidy data set.</p>
<p>In Chapter <a href="4-viz.html#viz">4</a>, we also introduced some ways to summarize and manipulate data to suit your needs. This chapter focuses more on the details of this by giving a variety of examples using the five main verbs in the <code>dplyr</code> package. There are more advanced operations that can be done than these and you’ll see some examples of this near the end of the chapter.</p>
<p>As we saw with the RStudio cheatsheet on <a href="https://www.rstudio.com/wp-content/uploads/2015/12/ggplot2-cheatsheet-2.0.pdf">data visualization</a>, RStudio has also created a cheatsheet for data manipulation entitled “Data Wrangling with dplyr and tidyr” available <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">here</a>. We will focus only on the <code>dplyr</code> functions in this book, but you are encouraged to also explore <code>tidyr</code> if you are presented with data that is not in the tidy format that we have specified as the preferred option for our purposes.</p>
<div id="five-main-verbs---the-fmv" class="section level2">
<h2><span class="header-section-number">5.1</span> Five Main Verbs - The FMV</h2>
<p>If you scan over the Data Wrangling cheatsheet, you may be initially overwhelmed by the amount of functions available. You’ll see the use of all of these as you work more and more with data frames in R. The <code>d</code> in <code>dplyr</code> stands for data frames so the functions here work when you are working with objects of the data frame type.</p>
<p>It’s most important for you to focus on the five most commonly used functions that help us manipulate and summarize data. A description of these verbs follows with each subsection devoted to seeing an example of that verb in play (or a combination of a few verbs):</p>
<ul>
<li><code>select</code>: Choose variables/columns by their names</li>
<li><code>filter</code>: Pick rows based on conditions about their values</li>
<li><code>summarize</code>: Create summary measures of variables (or groups of observations on variables using <code>group_by</code>)</li>
<li><code>mutate</code>: Make a new variable in the data frame</li>
<li><code>arrange</code>: Sort the rows based on one or more variables</li>
</ul>
<p>Just as we had the FNG (The Five Named Graphs in Chapter <a href="4-viz.html#viz">4</a> using <code>ggplot2</code>), we have the FMV here (The Five Main Verbs in <code>dplyr</code>):</p>
<div id="select-variables-using-select" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Select variables using <code id="select">select</code></h3>
<div class="figure" style="text-align: center"><span id="fig:selectfig"></span>
<img src="images/select.png" alt="Select diagram from Data Wrangling with dplyr and tidyr cheatsheet" width="578" />
<p class="caption">
Figure 5.1: Select diagram from Data Wrangling with dplyr and tidyr cheatsheet
</p>
</div>
<p>We’ve seen that the <code>flights</code> data frame in the <code>nycflights13</code> package contains many different variables (19 in fact). You can identify this by running the <code>dim</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
<span class="kw">data</span>(flights)
<span class="kw">dim</span>(flights)</code></pre></div>
<pre><code>## [1] 336776     19</code></pre>
<p>One of these variables is <code>year</code>. If you remember the original description of the <code>flights</code> data frame (or by running <code>?flights</code>), you’ll remember that this data correspond to flights in 2013 departing New York City. The <code>year</code> variable isn’t really a variable here in that it doesn’t vary… <code>flights</code> actually comes from a larger data set that covers many years. We may want to remove the <code>year</code> variable from our data set. To do so easily, we use the <code>select</code> variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
flights &lt;-<span class="st"> </span><span class="kw">select</span>(<span class="dt">.data =</span> flights, -year)
<span class="kw">names</span>(flights)</code></pre></div>
<pre><code>##  [1] &quot;month&quot;          &quot;day&quot;            &quot;dep_time&quot;       &quot;sched_dep_time&quot;
##  [5] &quot;dep_delay&quot;      &quot;arr_time&quot;       &quot;sched_arr_time&quot; &quot;arr_delay&quot;     
##  [9] &quot;carrier&quot;        &quot;flight&quot;         &quot;tailnum&quot;        &quot;origin&quot;        
## [13] &quot;dest&quot;           &quot;air_time&quot;       &quot;distance&quot;       &quot;hour&quot;          
## [17] &quot;minute&quot;         &quot;time_hour&quot;</code></pre>
<p>The <code>names</code> function gives a listing of all the columns in a data frame. We see that <code>year</code> has been removed. This was done using a <code>-</code> in front of the name of the column we’d like to remove.</p>
<p>We could also select specific columns (instead of deselecting columns) by listing them out:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flight_dep_times &lt;-<span class="st"> </span><span class="kw">select</span>(flights, month, day, dep_time, sched_dep_time)
flight_dep_times</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    month   day dep_time sched_dep_time
##    &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1      1     1      517            515
## 2      1     1      533            529
## 3      1     1      542            540
## 4      1     1      544            545
## 5      1     1      554            600
## 6      1     1      554            558
## 7      1     1      555            600
## 8      1     1      557            600
## 9      1     1      557            600
## 10     1     1      558            600
## # ... with 336,766 more rows</code></pre>
<p>Or we could specify a ranges of columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flight_arr_times &lt;-<span class="st"> </span><span class="kw">select</span>(flights, month:day, arr_time:sched_arr_time)
flight_arr_times</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    month   day arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
## 1      1     1      830            819
## 2      1     1      850            830
## 3      1     1      923            850
## 4      1     1     1004           1022
## 5      1     1      812            837
## 6      1     1      740            728
## 7      1     1      913            854
## 8      1     1      709            723
## 9      1     1      838            846
## 10     1     1      753            745
## # ... with 336,766 more rows</code></pre>
<p>The <code>select</code> function can also be used to reorder columns in combination with the <code>everything</code> helper function. Let’s suppose we’d like the <code>hour</code>, <code>minute</code>, and <code>time_hour</code> variables, which appear at the end of the <code>flights</code> data set to actually appear immediately after the <code>day</code> variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_reorder &lt;-<span class="st"> </span><span class="kw">select</span>(flights, month:day, hour:time_hour, <span class="kw">everything</span>())
<span class="kw">names</span>(flights_reorder)</code></pre></div>
<pre><code>##  [1] &quot;month&quot;          &quot;day&quot;            &quot;hour&quot;           &quot;minute&quot;        
##  [5] &quot;time_hour&quot;      &quot;dep_time&quot;       &quot;sched_dep_time&quot; &quot;dep_delay&quot;     
##  [9] &quot;arr_time&quot;       &quot;sched_arr_time&quot; &quot;arr_delay&quot;      &quot;carrier&quot;       
## [13] &quot;flight&quot;         &quot;tailnum&quot;        &quot;origin&quot;         &quot;dest&quot;          
## [17] &quot;air_time&quot;       &quot;distance&quot;</code></pre>
<p>Lastly, the helper functions <code>starts_with</code>, <code>ends_with</code>, and <code>contains</code> can be used to choose column names that match those conditions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_begin_a &lt;-<span class="st"> </span><span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;a&quot;</span>))
flights_begin_a</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    arr_time arr_delay air_time
##       &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1       830        11      227
## 2       850        20      227
## 3       923        33      160
## 4      1004       -18      183
## 5       812       -25      116
## 6       740        12      150
## 7       913        19      158
## 8       709       -14       53
## 9       838        -8      140
## 10      753         8      138
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_delays &lt;-<span class="st"> </span><span class="kw">select</span>(flights, <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>))
flights_delays</code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    dep_delay arr_delay
##        &lt;dbl&gt;     &lt;dbl&gt;
## 1          2        11
## 2          4        20
## 3          2        33
## 4         -1       -18
## 5         -6       -25
## 6         -4        12
## 7         -5        19
## 8         -3       -14
## 9         -3        -8
## 10        -2         8
## # ... with 336,766 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_time &lt;-<span class="st"> </span><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;time&quot;</span>))
flights_time</code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
## 1       517            515      830            819      227
## 2       533            529      850            830      227
## 3       542            540      923            850      160
## 4       544            545     1004           1022      183
## 5       554            600      812            837      116
## 6       554            558      740            728      150
## 7       555            600      913            854      158
## 8       557            600      709            723       53
## 9       557            600      838            846      140
## 10      558            600      753            745      138
## # ... with 336,766 more rows, and 1 more variables: time_hour &lt;time&gt;</code></pre>
<p>Another useful function is <code>rename</code>, which as you may suspect renames one column to another name. Suppose we wanted <code>dep_time</code> and <code>arr_time</code> to be <code>departure_time</code> and <code>arrival_time</code> instead in the <code>flights_time</code> data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_time &lt;-<span class="st"> </span><span class="kw">rename</span>(flights_time,
                       <span class="dt">departure_time =</span> dep_time,
                       <span class="dt">arrival_time =</span> arr_time)
<span class="kw">names</span>(flights_time)</code></pre></div>
<pre><code>## [1] &quot;departure_time&quot; &quot;sched_dep_time&quot; &quot;arrival_time&quot;   &quot;sched_arr_time&quot;
## [5] &quot;air_time&quot;       &quot;time_hour&quot;</code></pre>
<p>It’s easy to forget if the new name comes before or after the equals sign. I usually remember this as “New Before, Old After” or NBOA.</p>
<p>You’ll receive an error if you try to do it the other way:</p>
<pre><code>Error: Unknown variables: departure_time, arrival_time.</code></pre>
<hr />
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.1)</strong> How many different ways are there to select all three of <code>dest</code>, <code>air_time</code>, and <code>distance</code> variables from <code>flights</code>? Give the code showing how to do all of them you can think of.</p>
<p><strong>(LC5.2)</strong> How could one use <code>starts_with</code>, <code>ends_with</code>, and <code>contains</code> to select columns from a dataset with 100 or so columns? Think up a dataset that might have that many columns and discuss how each of these functions could be used to make smaller data sets.</p>
<p><strong>(LC5.3)</strong> Why might we want to use the <code>select</code> function on a data frame?</p>
<hr />
</div>
<div id="filter-observations-using-filter" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Filter observations using <code id="filter">filter</code></h3>
<div class="figure" style="text-align: center"><span id="fig:filter"></span>
<img src="images/filter.png" alt="Filter diagram from Data Wrangling with dplyr and tidyr cheatsheet" width="613" />
<p class="caption">
Figure 5.2: Filter diagram from Data Wrangling with dplyr and tidyr cheatsheet
</p>
</div>
<p>All of the FMVs follow the same syntax with the first argument to the function/verb being the name of the data frame and then the other arguments specifying which criteria you’d like the verb to work with.</p>
<p>The <code>filter</code> function here works much like the “Filter” option in Microsoft Excel. It allows you to specify criteria about values of variable in your data set and then chooses only those rows that match that criteria. We begin by focusing only on flights from New York City to Portland, Oregon. The <code>dest</code> code (or airport code) for Portland, Oregon is <code>&quot;PDX&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portland_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dest ==<span class="st"> &quot;PDX&quot;</span>)
portland_flights</code></pre></div>
<pre><code>## # A tibble: 1,354 x 18
##    month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1      1     1     1739           1740        -1     2051
## 2      1     1     1805           1757         8     2117
## 3      1     1     2052           2029        23     2349
## 4      1     2      804            805        -1     1039
## 5      1     2     1552           1550         2     1853
## 6      1     2     1727           1720         7     2042
## 7      1     2     1738           1740        -2     2028
## 8      1     2     2024           2029        -5     2314
## 9      1     3     1755           1745        10     2110
## 10     1     3     1814           1727        47     2108
## # ... with 1,344 more rows, and 12 more variables:
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;time&gt;</code></pre>
<p>Note the second equals sign here. You are almost guaranteed to make the mistake at least one of only including one equals sign. Let’s see what happens when we make this error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portland_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, <span class="dt">dest =</span> <span class="st">&quot;PDX&quot;</span>)</code></pre></div>
<pre><code>Error: filter() takes unnamed arguments. Do you need `==`?</code></pre>
<p>We see that there were 1354 flights from New York City to Portland in 2013. Let’s combine this with what we saw in Subsection <a href="5-manip.html#select"><strong>??</strong></a> to ensure that Portland flights were selected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reordered_flights &lt;-<span class="st"> </span><span class="kw">select</span>(flights, dest, <span class="kw">everything</span>())
pdx_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(reordered_flights, dest ==<span class="st"> &quot;PDX&quot;</span>)
pdx_flights</code></pre></div>
<pre><code>## # A tibble: 1,354 x 18
##     dest month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1    PDX     1     1     1739           1740        -1     2051
## 2    PDX     1     1     1805           1757         8     2117
## 3    PDX     1     1     2052           2029        23     2349
## 4    PDX     1     2      804            805        -1     1039
## 5    PDX     1     2     1552           1550         2     1853
## 6    PDX     1     2     1727           1720         7     2042
## 7    PDX     1     2     1738           1740        -2     2028
## 8    PDX     1     2     2024           2029        -5     2314
## 9    PDX     1     3     1755           1745        10     2110
## 10   PDX     1     3     1814           1727        47     2108
## # ... with 1,344 more rows, and 11 more variables:
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;time&gt;</code></pre>
<p>We see that Portland flights were selected here. You could also run <code>View(pdx_flights)</code> to glance at the data in spreadsheet form.</p>
<p>You can combine multiple criteria together using operators that make comparisons:</p>
<ul>
<li><code>|</code> corresponds to “or”</li>
<li><code>&amp;</code> corresponds to “and”</li>
</ul>
<p>We can often skip the use of <code>&amp;</code> and just separate our conditions with a comma. You’ll see this in the example below.</p>
<p>In addition, you can use other mathematical checks (similar to <code>==</code>):</p>
<ul>
<li><code>&gt;</code> corresponds to “greater than”</li>
<li><code>&lt;</code> corresponds to “less than”</li>
<li><code>&gt;=</code> corresponds to “greater than or equal to”</li>
<li><code>&lt;=</code> corresponds to “less than or equal to”</li>
<li><code>!=</code> corresponds to “not equal to”</li>
</ul>
<p>To see many of these in action, let’s select all flights that left JFK airport heading to Burlington, Vermont (<code>&quot;BTV&quot;</code>) or Seattle, Washington (<code>&quot;SEA&quot;</code>) in the months of October, November, or December:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">btv_sea_flights_fall &lt;-<span class="st"> </span><span class="kw">filter</span>(flights,
                               origin ==<span class="st"> &quot;JFK&quot;</span>, 
                               (dest ==<span class="st"> &quot;BTV&quot;</span>) |<span class="st"> </span>(dest ==<span class="st"> &quot;SEA&quot;</span>),
                               month &gt;=<span class="st"> </span><span class="dv">10</span>)</code></pre></div>
<p>Another example uses the <code>!</code> to choose pick rows that <strong>DON’T</strong> match a condition. Here we are referring to excluding the Northern Hemisphere summer months of June, July, and August.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_summer_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights,
                             !<span class="kw">between</span>(month, <span class="dv">6</span>, <span class="dv">8</span>))
not_summer_flights</code></pre></div>
<pre><code>## # A tibble: 249,781 x 18
##    month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1      1     1      517            515         2      830
## 2      1     1      533            529         4      850
## 3      1     1      542            540         2      923
## 4      1     1      544            545        -1     1004
## 5      1     1      554            600        -6      812
## 6      1     1      554            558        -4      740
## 7      1     1      555            600        -5      913
## 8      1     1      557            600        -3      709
## 9      1     1      557            600        -3      838
## 10     1     1      558            600        -2      753
## # ... with 249,771 more rows, and 12 more variables:
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;time&gt;</code></pre>
<p>To check that we are correct here we can use the <code>count</code> function on the <code>month</code> variable in our <code>not_summer_flights</code> data frame to ensure June, July, and August are not selected:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(not_summer_flights, month)</code></pre></div>
<pre><code>## # A tibble: 9 x 2
##   month     n
##   &lt;int&gt; &lt;int&gt;
## 1     1 27004
## 2     2 24951
## 3     3 28834
## 4     4 28330
## 5     5 28796
## 6     9 27574
## 7    10 28889
## 8    11 27268
## 9    12 28135</code></pre>
<p>The function <code>between</code> is a shortcut. We could also have written the following to get the same result:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_summer2 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month &lt;=<span class="st"> </span><span class="dv">5</span> |<span class="st"> </span>month &gt;=<span class="st"> </span><span class="dv">9</span>)
<span class="kw">count</span>(not_summer2, month)</code></pre></div>
<pre><code>## # A tibble: 9 x 2
##   month     n
##   &lt;int&gt; &lt;int&gt;
## 1     1 27004
## 2     2 24951
## 3     3 28834
## 4     4 28330
## 5     5 28796
## 6     9 27574
## 7    10 28889
## 8    11 27268
## 9    12 28135</code></pre>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.4)</strong> What’s another way using <code>!</code> we could filter only the rows that are not summer months (June, July, or August) in the <code>flights</code> data frame?</p>
<hr />
</div>
<div id="summarize-variables-using-summarize" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Summarize variables using <code>summarize</code></h3>
<div class="figure" style="text-align: center"><span id="fig:sum1"></span>
<img src="images/summarize1.png" alt="Summarize diagram from Data Wrangling with dplyr and tidyr cheatsheet" width="579" />
<p class="caption">
Figure 5.3: Summarize diagram from Data Wrangling with dplyr and tidyr cheatsheet
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:sum2"></span>
<img src="images/summary.png" alt="Another summarize diagram from Data Wrangling with dplyr and tidyr cheatsheet" width="343" />
<p class="caption">
Figure 5.4: Another summarize diagram from Data Wrangling with dplyr and tidyr cheatsheet
</p>
</div>
<p>We saw in Subsection <a href="4-viz.html#contsum">4.2.1</a> a way to calculate the standard deviation and mean of the temperature variable <code>temp</code> in the <code>weather</code> data frame of <code>nycflights</code>. We can do so in one step using the <code>summarize</code> function in <code>dplyr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(weather,
          <span class="dt">mean =</span> <span class="kw">mean</span>(temp),
          <span class="dt">std_dev =</span> <span class="kw">sd</span>(temp))</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    mean std_dev
##   &lt;dbl&gt;   &lt;dbl&gt;
## 1    NA      NA</code></pre>
<p>What happened here? The mean and the standard deviation temperatures are missing? Remember that by default the <code>mean</code> and <code>sd</code> functions do not ignore missing values. We need to specify <code>TRUE</code> for the <code>na.rm</code> parameter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_temp &lt;-<span class="st"> </span><span class="kw">summarize</span>(weather,
          <span class="dt">mean =</span> <span class="kw">mean</span>(temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">std_dev =</span> <span class="kw">sd</span>(temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
          )
summary_temp</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       mean  std_dev
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1 55.20351 17.78212</code></pre>
<p>We’ve created a small data frame here called <code>summary_temp</code> that includes both the <code>mean</code> and the <code>std_dev</code> of the <code>temp</code> variable in <code>weather</code>. If we’d like to access either of these values directly we can use the <code>$</code> to specify a column in a data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_temp$mean</code></pre></div>
<pre><code>## [1] 55.20351</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_temp$std_dev</code></pre></div>
<pre><code>## [1] 17.78212</code></pre>
<p>It’s often more useful to summarize a variable based on the groupings of another variable. Let’s say we were interested in the mean and standard deviation of temperatures for each month. We believe that you will be amazed at just how simple this is:</p>
<div class="figure" style="text-align: center"><span id="fig:groupsummarize"></span>
<img src="images/group_summary.png" alt="Group by and summarize diagram from Data Wrangling with dplyr and tidyr cheatsheet" width="472" />
<p class="caption">
Figure 5.5: Group by and summarize diagram from Data Wrangling with dplyr and tidyr cheatsheet
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grouped_weather &lt;-<span class="st"> </span><span class="kw">group_by</span>(weather, month)
summary_tempXmonth &lt;-<span class="st"> </span><span class="kw">summarize</span>(grouped_weather,
          <span class="dt">mean =</span> <span class="kw">mean</span>(temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">std_dev =</span> <span class="kw">sd</span>(temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
          )
summary_tempXmonth</code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    month     mean   std_dev
##    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1      1 35.64127 10.185459
## 2      2 34.15454  6.940228
## 3      3 39.81404  6.224948
## 4      4 51.67094  8.785250
## 5      5 61.59185  9.608687
## 6      6 72.14500  7.603356
## 7      7 80.00967  7.147631
## 8      8 74.40495  5.171365
## 9      9 67.42582  8.475824
## 10    10 60.03305  8.829652
## 11    11 45.10893 10.502249
## 12    12 38.36811  9.940822</code></pre>
<p>By simply grouping the <code>weather</code> data set by <code>month</code> first and then passing this new data frame into <code>summarize</code> we get a resulting data frame that shows the mean and standard deviation temperature for each month in New York City.</p>
<p>Another useful function is the <code>n</code> function which gives a count of how many entries appeared in the groupings. Suppose we’d like to get a sense for how many flights departed each of the three airports in New York City:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grouped_flights &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, origin)
by_origin &lt;-<span class="st"> </span><span class="kw">summarize</span>(grouped_flights,
                       <span class="dt">count =</span> <span class="kw">n</span>())
by_origin</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   origin  count
##    &lt;chr&gt;  &lt;int&gt;
## 1    EWR 120835
## 2    JFK 111279
## 3    LGA 104662</code></pre>
<p>We see that Newark (<code>&quot;EWR&quot;</code>) had the most flights departing in 2013 followed by <code>&quot;JFK&quot;</code> and lastly by LaGuardia (<code>&quot;LGA&quot;</code>).</p>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.5)</strong> What does the standard deviation column in the <code>summary_tempXmonth</code> data frame tell us about temperatures in New York City throughout the year?</p>
<p><strong>(LC5.6)</strong> What code would be required to get the mean and standard deviation temperature for each day in 2013 for NYC?</p>
<p><strong>(LC5.7)</strong> How could we identify how many flights left each of the three airports in each of the months of 2013?</p>
<hr />
</div>
<div id="create-new-variableschange-old-variables-using-mutate" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Create new variables/change old variables using <code>mutate</code></h3>
<div class="figure" style="text-align: center"><span id="fig:select"></span>
<img src="images/mutate.png" alt="Mutate diagram from Data Wrangling with dplyr and tidyr cheatsheet" width="612" />
<p class="caption">
Figure 5.6: Mutate diagram from Data Wrangling with dplyr and tidyr cheatsheet
</p>
</div>
<p>When looking at the <code>flights</code> data set, there are some clear additional variables that could be calculated based on the values of variables already in the data set. Passengers are often frustrated when their flights departs late, but change their mood a bit if pilots can make up some time during the flight to get them to their destination close to when they expected to land. This is commonly referred to as gain and we will create this variable using the <code>mutate</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_plus &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights,
         <span class="dt">gain =</span> arr_delay -<span class="st"> </span>dep_delay)</code></pre></div>
<p>We can now look at summary measures of this <code>gain</code> variable and even plot it in the form of a histogram:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gain_summary &lt;-<span class="st"> </span><span class="kw">summarize</span>(flights_plus,
          <span class="dt">min =</span> <span class="kw">min</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">q1 =</span> <span class="kw">quantile</span>(gain, <span class="fl">0.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">median =</span> <span class="kw">quantile</span>(gain, <span class="fl">0.5</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">q3 =</span> <span class="kw">quantile</span>(gain, <span class="fl">0.75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">max =</span> <span class="kw">max</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">mean =</span> <span class="kw">mean</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">sd =</span> <span class="kw">sd</span>(gain, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
          <span class="dt">missing =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(gain))
)
gain_summary</code></pre></div>
<pre><code>## # A tibble: 1 x 8
##     min    q1 median    q3   max      mean       sd missing
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;int&gt;
## 1  -109   -17     -7     3   196 -5.659779 18.04365    9430</code></pre>
<p>We’ve recreated the <code>summary</code> function we say in Chapter <a href="4-viz.html#viz">4</a> here using the <code>summarize</code> function in <code>dplyr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(flights_plus, <span class="kw">aes</span>(<span class="dt">x =</span> gain)) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bins =</span> <span class="dv">20</span>)</code></pre></div>
<p><img src="ismay_kim_files/figure-html/unnamed-chunk-64-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can also create multiple columns at once and even refer to columns that were just created in a new column. Hadley produces one such example in Chapter 5 of “R for Data Science” <span class="citation">(Grolemund and Wickham <a href="#ref-r4ds2016">2016</a>)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_plus2 &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights,
  <span class="dt">gain =</span> arr_delay -<span class="st"> </span>dep_delay,
  <span class="dt">hours =</span> air_time /<span class="st"> </span><span class="dv">60</span>,
  <span class="dt">gain_per_hour =</span> gain /<span class="st"> </span>hours
)</code></pre></div>
<hr />
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.8)</strong> What do positive values of the <code>gain</code> variable in <code>flights_plus</code> correspond to? What about negative values? And what about a zero value?</p>
<p><strong>(LC5.9)</strong> Could we create the <code>dep_delay</code> and <code>arr_delay</code> columns by simply subtracting <code>dep_time</code> from <code>sched_dep_time</code> and similarly for arrivals? Try the code out and explain any differences between the result and what actually appears in <code>flights</code>.</p>
<p><strong>(LC5.10)</strong> What can we say about the distribution of <code>gain</code>? Describe it in a few sentences using the plot and the <code>gain_summary</code> data frame values.</p>
<hr />
</div>
<div id="reorder-the-data-frame-using-arrange" class="section level3">
<h3><span class="header-section-number">5.1.5</span> Reorder the data frame using <code id="arrange">arrange</code></h3>
<p>If you’ve ever worked with data, one of the most common things you’d like to do is sort it. Have you ever been asked to calculate a median by hand? This requires you to put the data in order from smallest to highest in value. The <code>dplyr</code> package has a function called <code>arrange</code> that we will use to sort/reorder our data according to the values of the specified variable. This is most frequently used after we have used the <code>group_by</code> and <code>summarize</code> functions as we will see.</p>
<p>Let’s suppose we were interested in determining the most frequent destination airports from New York City in 2013:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_dest &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, dest)
freq_dest &lt;-<span class="st"> </span><span class="kw">summarize</span>(by_dest, <span class="dt">num_flights =</span> <span class="kw">n</span>())
freq_dest</code></pre></div>
<pre><code>## # A tibble: 105 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    ABQ         254
## 2    ACK         265
## 3    ALB         439
## 4    ANC           8
## 5    ATL       17215
## 6    AUS        2439
## 7    AVL         275
## 8    BDL         443
## 9    BGR         375
## 10   BHM         297
## # ... with 95 more rows</code></pre>
<p>You’ll see that by default the values of <code>dest</code> are displayed in alphabetical order here. Remember to use <code>View()</code> in the R Console to look at all the values of <code>freq_dest</code> in spreadsheet format. We are interested in finding those airports that appear most:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(freq_dest, num_flights)</code></pre></div>
<pre><code>## # A tibble: 105 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    LEX           1
## 2    LGA           1
## 3    ANC           8
## 4    SBN          10
## 5    HDN          15
## 6    MTJ          15
## 7    EYW          17
## 8    PSP          19
## 9    JAC          25
## 10   BZN          36
## # ... with 95 more rows</code></pre>
<p>This is actually giving us the opposite of what we are looking for. It tells us the least frequent destination airports. To switch the ordering to be descending instead of ascending we use the <code>desc</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(freq_dest, <span class="kw">desc</span>(num_flights))</code></pre></div>
<pre><code>## # A tibble: 105 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    ORD       17283
## 2    ATL       17215
## 3    LAX       16174
## 4    BOS       15508
## 5    MCO       14082
## 6    CLT       14064
## 7    SFO       13331
## 8    FLL       12055
## 9    MIA       11728
## 10   DCA        9705
## # ... with 95 more rows</code></pre>
<p>We can also use the <code>top_n</code> function which automatically tells us the most frequent <code>num_flights</code>. We specify the top 10 airports here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">top_n</span>(freq_dest, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">wt =</span> num_flights)</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    ATL       17215
## 2    BOS       15508
## 3    CLT       14064
## 4    DCA        9705
## 5    FLL       12055
## 6    LAX       16174
## 7    MCO       14082
## 8    MIA       11728
## 9    ORD       17283
## 10   SFO       13331</code></pre>
<p>We’ll still need to arrange this by <code>num_flights</code> though:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(<span class="kw">top_n</span>(freq_dest, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">wt =</span> num_flights), <span class="kw">desc</span>(num_flights))</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    ORD       17283
## 2    ATL       17215
## 3    LAX       16174
## 4    BOS       15508
## 5    MCO       14082
## 6    CLT       14064
## 7    SFO       13331
## 8    FLL       12055
## 9    MIA       11728
## 10   DCA        9705</code></pre>
<p><strong>Note:</strong> Remember that I didn’t pull the <code>n</code> and <code>wt</code> arguments out of thin air. They can be found by using the <code>?</code> function on <code>top_n</code>.</p>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.11)</strong> Create a new data frame that shows the top 5 airports with the largest arrival delays from NYC in 2013.</p>
<hr />
</div>
</div>
<div id="the-pipe" class="section level2">
<h2><span class="header-section-number">5.2</span> The pipe <code>%&gt;%</code></h2>
<p>Just as the <code>+</code> sign was used to add layers to a plot created using <code>ggplot</code> we will use the pipe operator (<code>%&gt;%</code>) to chain together <code>dplyr</code> functions. We’ll see that we can even chain together <code>dplyr</code> functions and plotting code. (Both <code>ggplot2</code> and <code>dplyr</code> were created by Hadley after all.)</p>
<p>You may have been a little confused by the last chunk we created above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(<span class="kw">top_n</span>(freq_dest, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">wt =</span> num_flights), <span class="kw">desc</span>(num_flights))</code></pre></div>
<p>If we don’t create temporary variables like we did before with <code>by_dest</code>, <code>grouped_flights</code>, etc., we start to get into the issue of trying to match parentheses. We could separate this code a bit to help with this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(
  <span class="kw">top_n</span>(freq_dest, 
        <span class="dt">n =</span> <span class="dv">10</span>,
        <span class="dt">wt =</span> num_flights), 
  <span class="kw">desc</span>(num_flights))</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    ORD       17283
## 2    ATL       17215
## 3    LAX       16174
## 4    BOS       15508
## 5    MCO       14082
## 6    CLT       14064
## 7    SFO       13331
## 8    FLL       12055
## 9    MIA       11728
## 10   DCA        9705</code></pre>
<p>Even this make it difficult to understand what is exactly happening though. <code>desc(num_flights)</code> is an argument to <code>arrange</code>. The best way to fix this problem is the use of the chaining operator called the pipe (<code>%&gt;%</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">freq_dest %&gt;%
<span class="st">  </span><span class="kw">top_n</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">wt =</span> num_flights) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(num_flights))</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##     dest num_flights
##    &lt;chr&gt;       &lt;int&gt;
## 1    ORD       17283
## 2    ATL       17215
## 3    LAX       16174
## 4    BOS       15508
## 5    MCO       14082
## 6    CLT       14064
## 7    SFO       13331
## 8    FLL       12055
## 9    MIA       11728
## 10   DCA        9705</code></pre>
<p>Recall from Chapter @(viz) that we read the pipe operator as “and then”. So here we take the <code>freq_dest</code> data frame <strong>AND THEN</strong> we determine the top 10 values of <code>num_flights</code> <strong>AND THEN</strong> we arrange these top 10 flights according to a descending numbers of flights (from highest to lowest).</p>
<p>We can go one stop further and tie together the <code>group_by</code> and <code>summarize</code> functions we used to find the most frequent flights:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ten_freq_dests &lt;-<span class="st"> </span>flights %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(dest) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">num_flights =</span> <span class="kw">n</span>()) %&gt;%
<span class="st">  </span><span class="kw">top_n</span>(<span class="dt">n =</span> <span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(num_flights))</code></pre></div>
<pre><code>## Selecting by num_flights</code></pre>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.12)</strong> Recreate each of the chunks of code above Subsection <a href="5-manip.html#arrange"><strong>??</strong></a> in this chapter using the <code>%&gt;%</code> operator. Note that sometimes you can combine multiple subsequent chunks of code together. Do so whenever possible.</p>
<p><strong>(LC5.13)</strong> What benefits can you see to using the pipe instead of the other way of doing things as you saw throughout this chapter? Give specific examples.</p>
<p><strong>(LC5.14)</strong> Write out exactly how the <code>ten_freq_dests</code> data set was created using the “and then” verbiage.</p>
<hr />
<p>The piping syntax will be our major focus throughout the rest of this book and you’ll find that you’ll quickly be addicted to the chaining with some practice. If you’d like to see more examples on using <code>dplyr</code>, the FMV (in addition to some other <code>dplyr</code> verbs), and <code>%&gt;%</code> with the <code>nycflights13</code> data set, you can check out Chapter 5 of Hadley and Garrett’s book <span class="citation">(Grolemund and Wickham <a href="#ref-r4ds2016">2016</a>)</span>.</p>
</div>
<div id="joiningmerging-data-frames" class="section level2">
<h2><span class="header-section-number">5.3</span> Joining/merging data frames</h2>
<p>Something you may have thought to yourself as you looked at the most freqent destinations of flights from NYC in 2013 is</p>
<ul>
<li>“What cities are these airports in?”</li>
<li>“Is <code>&quot;ORD&quot;</code> Orlando?”</li>
<li>“Where is <code>&quot;FLL&quot;</code>?</li>
</ul>
<p>The <code>nycflights13</code> data source contains multiple data frames. Instead of having to manually look up different values of airport names corresponding to airport codes like <code>ORD</code>, we can have R automatically do this “looking up” for us.</p>
<p>To do so, we’ll need to tell R how to match one data frame to another data frame. Let’s first check out the <code>airports</code> data frame inside of R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(airports)</code></pre></div>
<p>The first column <code>faa</code> corresponds to the airport codes that we saw in <code>dest</code> in our <code>flights</code> and subsequent <code>ten_freq_dests</code> data sets. Hadley and Garrett <span class="citation">(Grolemund and Wickham <a href="#ref-r4ds2016">2016</a>)</span> created the following diagram to help us understand how the different data sets are linked:</p>
<div class="figure" style="text-align: center"><span id="fig:reldiagram"></span>
<img src="images/relational-nycflights.png" alt="Data relationships in nycflights13 from R for Data Science" width="396" />
<p class="caption">
Figure 5.7: Data relationships in nycflights13 from R for Data Science
</p>
</div>
<p>We see from <code>View(airports)</code> that <code>airports</code> contains a lot of other information about 1396. We are only really interested here in the <code>faa</code> and <code>name</code> columns. Let’s use the <code>select</code> function to only use those variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airports_small &lt;-<span class="st"> </span>airports %&gt;%
<span class="st">  </span><span class="kw">select</span>(faa, name)</code></pre></div>
<p>So if we identify the names of the airports we can use the <code>inner_join</code> function. Note that we will also rename the subsequent column <code>name</code> as <code>airport_name</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">named_freq_dests &lt;-<span class="st"> </span>ten_freq_dests %&gt;%
<span class="st">  </span><span class="kw">inner_join</span>(airports_small, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">airport_name =</span> name)
named_freq_dests</code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     dest num_flights                       airport_name
##    &lt;chr&gt;       &lt;int&gt;                              &lt;chr&gt;
## 1    ORD       17283                 Chicago Ohare Intl
## 2    ATL       17215    Hartsfield Jackson Atlanta Intl
## 3    LAX       16174                   Los Angeles Intl
## 4    BOS       15508 General Edward Lawrence Logan Intl
## 5    MCO       14082                       Orlando Intl
## 6    CLT       14064             Charlotte Douglas Intl
## 7    SFO       13331                 San Francisco Intl
## 8    FLL       12055     Fort Lauderdale Hollywood Intl
## 9    MIA       11728                         Miami Intl
## 10   DCA        9705      Ronald Reagan Washington Natl</code></pre>
<p>In case you didn’t know, <code>&quot;ORD&quot;</code> is the airport code of Chicago O’Hare airport and <code>&quot;FLL&quot;</code> is the main airport in Fort Lauderdale, Florida.</p>
<p>A visual representation of the <code>inner_join</code> is given <span class="citation">(Grolemund and Wickham <a href="#ref-r4ds2016">2016</a>)</span>:</p>
<div class="figure" style="text-align: center"><span id="fig:ijdiagram"></span>
<img src="images/join-inner.png" alt="Diagram of inner join from R for Data Science" width="338" />
<p class="caption">
Figure 5.8: Diagram of inner join from R for Data Science
</p>
</div>
<p>There are more complex joins available, but the <code>inner_join</code> will solve nearly all (if not all) of the problems you’ll face in our experience.</p>
<hr />
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<p><strong>(LC5.15)</strong> What happens when you try to <code>inner_join</code> the <code>ten_freq_dests</code> data frame with <code>airports</code> instead of <code>airports_small</code>? How might one use this result to answer further questions about the top 10 destinations?</p>
<p><strong>(LC5.16)</strong> What surprises you about the top 10 destinations from NYC in 2013?</p>
<hr />
</div>
<div id="whats-to-come-2" class="section level2">
<h2><span class="header-section-number">5.4</span> What’s to come?</h2>
<p>This concludes the <strong>Data Exploration</strong> unit of this book. You should be pretty proficient in both plotting variables (or multiple variables together) in various data sets and manipulating data as we’ve done in this chapter. You are encouraged to step back through the code in earlier chapters and make changes as you see fit based on your updated knowledge.</p>
<p>In Chapter <a href="6-collect.html#collect">6</a>, we’ll begin to build the pieces needed to understand how this unit of <strong>Data Exploration</strong> can tie into statistical inference in the <strong>Inference</strong> part of the book. Remember that the focus throughout is on data visualization and we’ll see that next when we discuss sampling.</p>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-r4ds2016">
<p>Grolemund, Garrett, and Hadley Wickham. 2016. <em>R for Data Science</em>. <a href="http://r4ds.had.co.nz/" class="uri">http://r4ds.had.co.nz/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-viz.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-collect.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-manipulating_data.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
